<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script type="text/javascript">
        let isStart = true;
        function websocketConnect() {
            if ("WebSocket" in window) {
                let hostname = window.location.hostname;
                let port = window.location.port;
                let ws = new WebSocket("ws://" + hostname + ":" + port);
                ws.onopen = function () {
                    document.getElementById("connectionStatus").innerText = "ðŸŸ¢";
                }
                ws.onclose = function () {
                    document.getElementById("connectionStatus").innerText = "ðŸ”´";
                    setTimeout(function () {
                        websocketConnect();
                    }, 3000);
                }
                ws.onmessage = function (event) {
                    if (isStart == false) {
                        return;
                    }
                    let data = event.data;
                    let li = document.createElement("li");
                    li.innerHTML = data;
                    // let text = document.createTextNode(data);
                    // li.appendChild(text);
                    let console = document.getElementById("panel");
                    let bool = console.scrollHeight - console.scrollTop === console.clientHeight;
                    document.getElementById("console").appendChild(li);
                    if (bool == true) {
                        scrollToBottomIfNeed();
                    }
                }
            } else {
                console.log("not support websocket");
            }
        }
        function scrollToBottomIfNeed() {
            let element = document.getElementById("panel");
            element.scrollTop = element.scrollHeight - element.clientHeight;
        }
        function cleanConsole() {
            let console = document.getElementById("console");
            console.innerHTML = "";
        }
        function toggle() {
            if (isStart) {
                let hr = document.createElement("hr");
                document.getElementById("console").appendChild(hr);
                scrollToBottomIfNeed();
            }
            isStart = !isStart;

            let button = document.getElementById("toggleButton");
            button.innerHTML = isStart ? "stop" : "start";
        }
        </script>
        <style>
            body {
                padding: 0;
                margin: 0;
                background-color: rgb(38, 31, 35);
            }
            #page {
                padding: 0;
                margin: 0;
                width: 100%;
                height: 100vh;
                display: flex;
                flex-direction: column;
                /* -webkit-overflow-scrolling: touch; */
            }
            #menu,#toolbar {
                background-color: rgb(38, 31, 35);
                flex: 1;
                min-height: 22px;
                padding: 8px;
                display: flex;
                flex-direction: row-reverse;
            }
            #toolbar {
                flex: 2;
                min-height: 30px;
            }
            #panel {
                flex: 40;
                background-color: rgb(40, 43, 53);
                overflow: hidden;
                overflow-y: auto;
            }
            #panel ul {
                list-style: none;
                padding: 0px 20px 0px 20px;
                margin: 0;
            }
            #panel ul li {
                color: white;
                font-size:x-large;
            }
            .button {
                border: 2px solid white;
                color: white;
                padding: 0px 32px;
                margin-left: 10px;
                margin-right: 10px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 18px;
                font-weight: bold;
                transition-duration: 0.3s;
                cursor: pointer;
                background-color: transparent;
            }
            .button:hover {
                background-color: white;
                color: black;
            }
            .button1 {
                border: none;
                color: dodgerblue;
                font-size: 14px;
                font-weight: normal;
                padding: 0px 16px;
            }
            a {
                align-self: center;
                color: white;
                margin-left: 10px;
                margin-right: 10px;
            }
            hr {
                height: 2px;
                border-width: 0;
                color: rgb(199, 199, 199);
                background-color: rgb(199, 199, 199);
            }
            #connectionStatus {
                align-self: center;
                color: white;
                margin-left: 10px;
                margin-right: 10px;                
            }
        </style>
    </head>
    <body onload="websocketConnect()">
        <div id="page">
            <div id="menu">
                <a href="https://github.com/E13Lau/RemoteLogging.git">Github</a>
                <p id="connectionStatus" title="WebSocket connection">ðŸ”´</p>
                <button id="toggleButton" class="button button1" onclick="toggle()">stop</button>
            </div>
            <div id="panel">
                <ul id="console">
                </ul>
            </div>
            <div id="toolbar">
                <button class="button" onclick="scrollToBottomIfNeed()">to bottom</button>
                <button class="button" onclick="cleanConsole()">clean</button>
            </div>
        </div>
    </body>
</html>
